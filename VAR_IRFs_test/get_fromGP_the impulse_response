options=gpOptions("ftc")
options$kern$comp=list("rbf","white")
#options$learnScales=TRUE
model<-gpCreate(1,1,as.matrix(y),as.matrix(z),options)
yhat<-gpOut(model,as.matrix(y))
ss_y<-y-yhat

# impact of unitary shock (1) of x on y
y2<-gpOut(model,2+0*as.matrix(x))

cond_distr_ss_y <- ecdf(ss_y)

y_shocked = y2[1]+cond_distr_ss_y(runif(100,0,1))



  parents = which(graph_resit[,ii] ==1)
  if (length(parents)>0)
  {
    aux_pa = shocks[,parents]
    
    options=gpOptions("ftc")
    options$kern$comp=list("rbf","white")
    #options$learnScales=TRUE
    model<-gpCreate(length(parents),1,aux_pa,
                    residual[,ii],options)
    yhat<-gpOut(model,aux_pa)
    ss_y<-residual[,ii]-yhat
    
    # impact of unitary shock (1) of x on y
    y2<-gpOut(model,2+0*as.matrix(x))
    
    cond_distr_ss_y <- ecdf(ss_y)
    
    y_shocked = y2[1]+cond_distr_ss_y(runif(100,0,1))
    
    
  }else{
    shocks[,ii] = residual[,ii]
  }
  }
